# 🧠 어셈블리 CH05 

## 1. Stack (스택)

### 📌 개념

-   주기억장치의 일부를 **LIFO (Last In First Out)** 구조로 처리한다.
-   데이터는 **위에서 넣고 (push)** **위에서 꺼낸다 (pop)**.

------------------------------------------------------------------------

### 🧩 스택의 주요 요소

  항목              설명
  ----------------- --------------------------------------
  **Top Pointer**   스택의 최상단을 가리키는 포인터
  **Push**          데이터를 저장할 때 사용
  **Pop**           데이터를 꺼낼 때 사용
  **ESP**           스택 포인터 (Stack Pointer Register)
  **세그먼트**      데이터가 저장되는 구역을 나누는 단위

------------------------------------------------------------------------

### 🧱 주요 세그먼트 레지스터

  레지스터   역할
  ---------- ------------------------------------
  **CS**     Code Segment (명령어 코드 저장)
  **DS**     Data Segment (데이터 저장)
  **ES**     Extra Segment (추가 데이터 저장용)
  **SS**     Stack Segment (스택 데이터 저장)

------------------------------------------------------------------------

### ⚙️ 스택의 특징

-   **메모리 구조:**\
    맨 아래가 `0x0FF0`, 위로 올라갈수록 4씩 증가 → 맨 위는 `0x1000`
-   **데이터 간 간격**과 **입출력 관리**를 담당한다.

------------------------------------------------------------------------

### 🧮 PUSH 연산

1.  **SP 값을 감소(디크리먼트)** → 데이터를 저장\
    (스택이 **아래로 자라나는 구조**일 경우)
2.  반대로 위로 자라는 구조라면 **SP를 증가(인크리먼트)** 후 데이터 저장

------------------------------------------------------------------------

### 🔄 POP 연산

1.  SP가 가리키는 주소의 데이터를 **묵시적으로 AX** 레지스터로 가져온다.

------------------------------------------------------------------------

### 💡 스택의 사용처

  -----------------------------------------------------------------------
  용도                                설명
  ----------------------------------- -----------------------------------
  **레지스터 저장**                   임시 데이터 보관

  **복귀 주소 저장**                  함수 호출 시 원래 위치로 돌아가기
                                      위해 사용

  **인자 전달 (Argument)**            프로시저(함수)로 매개변수를 전달할
                                      때 사용

  **프로그램 실행 중 함수 호출**      CALL / RET 명령 수행 시 활용
  -----------------------------------------------------------------------

------------------------------------------------------------------------

## 2. PUSH 명령어

  형식               설명
  ------------------ -------------------------------------
  `PUSH reg/mem16`   16비트 레지스터 또는 메모리 값 푸시
  `PUSH reg/mem32`   32비트 레지스터 또는 메모리 값 푸시
  `PUSH imm32`       32비트 즉시 값 푸시

------------------------------------------------------------------------

## 3. POP 명령어

  형식              설명
  ----------------- ----------------------------------
  `POP reg/mem16`   16비트 레지스터 또는 메모리로 팝
  `POP reg/mem32`   32비트 레지스터 또는 메모리로 팝

------------------------------------------------------------------------

## 4. PUSHFD / POPFD

-   **Flag Register**의 내용을 스택에 저장하거나 복원할 때 사용한다.

------------------------------------------------------------------------

## 5. PUSHAD / POPAD (PUSHA / POPA)

  -----------------------------------------------------------------------
  명령                                   설명
  -------------------------------------- --------------------------------
  **PUSHAD**                             EAX → ECX → EDX → EBX → ESP →
                                         EBP → ESI → EDI 순으로 저장

  **POPAD**                              반대 순서로 복원

  **사용 예시**                          작업 중 레지스터 상태를 보존하고
                                         복귀 시 되돌릴 때 사용
  -----------------------------------------------------------------------

📘 **예제:** \> 루프 안에 또 다른 루프가 있을 경우,\
\> ECX를 공유하기 때문에 `PUSH ECX`로 임시 저장 후 내부 루프 실행,\
\> 종료 후 `POP ECX`로 복원한다. (참고: CH5.P10)

------------------------------------------------------------------------

## 6. PROC (프로시저)

### 🧭 개념

-   **서브루틴(subroutine)** 형태의 함수
-   C언어의 `function`과 유사하며, 호출 시 `CALL`, 종료 시 `RET` 사용
-   `main PROC`에는 `RET`이 없고, 일반 프로시저에는 `RET`이 반드시 존재

------------------------------------------------------------------------

### 🔍 주요 규칙

  항목               설명
  ------------------ -----------------------------------------
  **RET**            호출한 지점으로 복귀
  **Label 접근**     해당 프로시저 내부 레이블만 접근 가능
  **Global Label**   콜론(`::`) 두 개 사용 (`destination::`)

------------------------------------------------------------------------

### 📝 주석 작성 규칙

1.  프로시저 목적 설명\
2.  파라미터 정의\
3.  리턴 값 기술\
4.  선조건(Pre-condition) 명시\
5.  파라미터와 로컬 변수 위치 명시

------------------------------------------------------------------------

## 7. CALL / RET

  명령          설명
  ------------- ----------------------------
  **CALL**      프로시저 호출
  **RET**       호출한 위치로 복귀
  **리턴 값**   보통 `EAX` 레지스터를 사용

------------------------------------------------------------------------

## 8. USER OPERATION (CH05.P22)

-   형식: `PROC USES esi ecx`
-   지정된 레지스터를 **자동으로 PUSH/POP 처리**하여 프로시저 내 보존

------------------------------------------------------------------------

## 9. 백그라운드 정보

### 🧩 Link Library

-   여러 개의 오브젝트 및 라이브러리 파일을 연결:

        link obj파일 lib파일 lib파일 ...

------------------------------------------------------------------------

📚 **요약** - Stack: 임시 저장소, LIFO 구조\
- PUSH/POP: 데이터 입출력\
- PROC: 서브루틴 구조\
- CALL/RET: 함수 호출과 복귀\
- PUSHAD/POPAD: 전체 레지스터 백업\
- USES: 자동 레지스터 보호

------------------------------------------------------------------------

